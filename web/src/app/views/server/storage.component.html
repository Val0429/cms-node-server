<div class="row">
  <div class="col-12">
    <app-storage-setting (reloadServerInfoEvent)="reloadServerInfo()"></app-storage-setting>
  </div>
</div>
<section class="widget">
  <div class="widget-header">
    <h1>Storage Server Overview</h1>
    <div class="float-right">
      <select class="select1 width-200" [(ngModel)]="overviewType" (change)="reloadServerInfo()">
        <option [value]="'RecordServer'">Record Server</option>
        <option [value]="'RecordFailoverServer'">Failover Server</option>
      </select>
    </div>
  </div>
  <div class="widget-body" *ngIf="!recordServerList">
    <div class="text-center">
      <i class="fa fa-refresh fa-spin fa-fw" style="font-size: 30px;"></i>
    </div>
  </div>
  <div class="widget-body" *ngIf="recordServerList">
    <div class="widget-table-overflow">
      <table class="table table-lg mt-lg mb-0 table-hover">
        <thead class="no-bd">
          <tr>
            <th>Server Name</th>
            <th>Connect Status</th>
            <th>IP Address</th>
            <th>Drive</th>
            <th>Keep Space</th>
            <th>Capacity</th>
            <th>Free Space</th>
            <th>Used Space</th>
            <th>Usage %</th>
          </tr>
        </thead>
        <tbody *ngIf="diskInfos">
          <ng-container *ngFor="let server of recordServerList">
            <tr *ngFor="let storage of server.Storage; let i = index;"  [class.first]="i === 0" [class.other]="i !== 0" (click)="clickEditStorage(server, i); modalWindow.show();">
              <td>
                <span *ngIf="i === 0">{{server.Name}}</span>
              </td>
              <td>
                <span *ngIf="i === 0">
                  <span class="text-default" *ngIf="getServerStatus(server, storage) === undefined">Connecting...</span>
                  <span class="text-success" *ngIf="getServerStatus(server, storage) === true">Connected</span>
                  <span class="text-danger" *ngIf="getServerStatus(server, storage) === false">Disconnected</span>
                </span>
              </td>
              <td>
                <span *ngIf="i === 0">{{server.Domain}}</span>
              </td>
              <td>{{getPathDrive(storage.Path)}}</td>
              <td>{{storage.KeepSpace}} GB</td>
              <td>{{getCapacity(server, storage)}}</td>
              <td>{{getFreeSpace(server, storage)}}</td>
              <td>{{countUsageSpace(server, storage)}}</td>
              <td>
                {{countUsagePercent(server, storage)}}%
                <div class="bg-gray-lighter progress progress-xs">
                  <div class="progress-bar progress-xs bg-bar-gray" [style.width]="countUsagePercent(server, storage) + '%'"></div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
      <div class="text-bold" *ngIf="recordServerList.length < 1" style="margin: 15px;">
        NO DATA
      </div>
    </div>
  </div>
</section>
<div bsModal #modalWindow="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header flex-column">
        <button (click)="modalWindow.hide()" aria-label="Close" class="close ml-auto" type="button">
          <span aria-hidden="true">Ã—</span>
        </button>
        <h4 class="modal-title text-center fw-bold">Storage Edit</h4>
      </div>
      <div class="modal-body" style="max-height: 500px;overflow-x: hidden;overflow-y: auto;">
        <app-storage-editor [serverInfo]="currentEditServer" [storageIndex]="currentEditStorageIndex" (closeEvent)="modalWindow.hide()"
          (reloadServerInfoEvent)="reloadServerInfo()"></app-storage-editor>
      </div>
    </div>
  </div>
</div>
